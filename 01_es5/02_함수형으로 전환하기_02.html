<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        var users = [
            {id:1, name:"ID", age:36},
            {id:2, name:"BJ", age:32},
            {id:3, name:"JM", age:32},
            {id:4, name:"PJ", age:27},
            {id:5, name:"HA", age:25},
            {id:6, name:"JE", age:26},
            {id:7, name:"JI", age:31},
            {id:8, name:"MP", age:23}
        ];

        /*
            function _filter(list, predi){
                var new_list = [];
                for(var i=0; i< list.length; i++){
                    if(predi(list[i])){
                        new_list.push(list[i]);
                    }
                }
                return new_list;
            }
            function _map(list, mapper){
                var new_list = [];
                for(var i=0; i<list.length; i++){
                    new_list.push(mapper(list[i]));
                }
                return new_list;
            }
        */
        
        function _filter(list, predi){
            var new_list = [];
            _each(list, function(val){
                if(predi(val)) new_list.push(val);
            });
            return new_list;
        }

        function _map(list, mapper){
            var new_list = [];
            _each(list, function(val){
                new_list.push(mapper(val));
            });
            return new_list;
        }

        // 3. _each 만들기
        // 3-1. _each로 _map, _filter 중복 제거
        // 3-2. 외부 다형성(array_like, document.querySelectorAll)
        // 3-3. 내부 다형성(predi, iter, mapper)
        function _each(list, iter){             // iter() : 반복문에서 어떤 작업을 할 지
            for(var i=0; i<list.length; i++){
                iter(list[i]);
            }
            return list;
        }

        console.log(
            _map(
                _filter(users, function(user) { return user.age >= 30; } ),
                function(user) { return user.name; }
            )
        );
        console.log(
            _map(
                _filter(users, function(user) { return user.age < 30; } ),
                function(user) { return user.age; }
            )
        );

        /*
            function <-> method

            javascript의 map, filter는 array 객체에서만 사용 가능 
            javascript의 map, filter는 array_like 객체에서는 사용 불가능 (ex) jquery 반환값, css selector의 반환값)

        */

        console.log(
            [1, 2, 3, 4].map(function(val){
                return val * 2;
            })
        );

        console.log(
            [1, 2, 3, 4].filter(function(val){
                return val % 2;
            })
        );

        console.log(document.querySelectorAll('*'));
        /* 
        map is not a function
        -> css selector의 반환값이 array가 아니기 때문에..

        console.log(
            document.querySelectorAll('*').map(function(node){
                return node.nodeName;
            })
        );
        */
        console.log(
            _map(document.querySelectorAll('*'), function(node){
                return node.nodeName;
            })
        )
        
    </script>
    
</body>
</html>